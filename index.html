<!DOCTYPE html>
<html>
<head>
    <title>Interventional Radiology</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
</head>
<style>
    #map {
        position: fixed;
        right: 0;
        left: 0;
        top: 0;
        bottom: 0;
    }
    .building-label {
        font-size: 10px;
        padding: 2px 4px;
    }
    #legend {
        position: absolute;
        bottom: 25px;
        right: 25px;
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
    }
</style>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
     <script src="js/data.js"></script>
    <script>
        // Initialize the map on the "map" div with a given center and zoom
        var map = L.map('map', {
            center: [20.0, 10.0],  // Modify as needed for your application's focus area
            zoom: 3,               // Adjust based on your preference
            minZoom: 2,            // Optional: minimum zoom level
            maxZoom: 19            // Optional: maximum zoom level
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Assuming data.js has properly initialized the `data` variable
        function getContinent(data, CONTINENT) {
            var filteredData = {"type":"FeatureCollection","features":[]};
            data.features.forEach(function(feature) {
                if (feature.properties.CONTINENT === CONTINENT) {
                    filteredData.features.push(feature);
                }
            });
            return filteredData;
        }

        var continents = {
            "Africa": getContinent(data, "Africa"),
            "Antarctica": getContinent(data, "Antarctica"),
            "Asia": getContinent(data, "Asia"),
            "North America": getContinent(data, "North America"),
            "South America": getContinent(data, "South America"),
            "Australia": getContinent(data, "Oceania"),
            "Europe": getContinent(data, "Europe")
        };

        function createPopupContent(feature) {
            var frequency = feature.properties.FREQUENCY;
            return `<div style='font-size:20px'>
                        <strong>Country:</strong> ${feature.properties.countriesPracIR}<br>
                        <strong>Number of Respondents:</strong> ${frequency}<br>
                        <strong>Diagnostic Radiology:</strong> ${feature.properties.SUM_DR} (${((feature.properties.SUM_DR / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Interventional Radiology:</strong> ${feature.properties.SUM_IR} (${((feature.properties.SUM_IR / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Interventional Radiology Trained:</strong> ${feature.properties.SUM_IRtrain} (${((feature.properties.SUM_IRtrain / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Interventional Radiology Graduated:</strong> ${feature.properties.SUM_Irgraduate} (${((feature.properties.SUM_Irgraduate / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Accredited Training:</strong> ${feature.properties.SUM_accredTrain} (${((feature.properties.SUM_accredTrain / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Faculty/Professor:</strong> ${feature.properties.SUM_facProf} (${((feature.properties.SUM_facProf / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Practice Interventional Radiology:</strong> ${feature.properties.SUM_pracIR} (${((feature.properties.SUM_pracIR / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Resident:</strong> ${feature.properties.SUM_resident} (${((feature.properties.SUM_resident / frequency) * 100).toFixed(2)}%)<br>
                        <strong>Fellow:</strong> ${feature.properties.SUM_fellow} (${((feature.properties.SUM_fellow / frequency) * 100).toFixed(2)}%)<br>
                     
                    </div>`;
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: function(e) {
                    var layer = e.target;
                    layer.setStyle({
                        weight: 5,
                        color: '#666',
                        dashArray: '',
                        fillOpacity: 0.7
                    });
                    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                        layer.bringToFront();
                    }
                },
                mouseout: function(e) {
                    e.target.setStyle({
                        weight: 1,
                        color: '#667',
                        dashArray: '3',
                        fillOpacity: 0.9
                    });
                },
                click: function(e) {
                    map.fitBounds(e.target.getBounds().pad(1.5));
                }
            });
            layer.bindPopup(createPopupContent(feature));
        }

        var continentLayers = {};
        Object.keys(continents).forEach(function(continent) {
            continentLayers[continent] = L.geoJSON(continents[continent], {
                onEachFeature: onEachFeature
            }).addTo(map);
        });

        L.control.layers(continentLayers, {}, {collapsed:false}).addTo(map);
    </script>
    

</body>
</html>
