<!DOCTYPE html>
<html>
<head>
    <title>Interventional Radiology</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" 
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" 
          crossorigin="">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
</head>
<style>
    .main-heading {
        font-size: 15px;
    }
    #selectedLayer {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-weight: bold;
        font-size: 22px;
        text-shadow: 2px 2px 2px white;
        z-index: 100;
        text-align: center;
    }
    .building-label {
        font-size: 10px;
        padding: 2px 4px;
    }
    #color-key {
        height: 150px;
        width: 20px;
        margin-left: 20px;
        border-left: 2px solid #333;
        background: linear-gradient(to top, #FEB24C, #FD8D3C, #FC4E2A, #E31A1C, #BD0026, #800026);
    }
    #legend {
        position: absolute;
        bottom: 25px;
        right: 25px;
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
    }
    #legend span {
        display: block;
        margin-top: 10px;
        font-size: 40px;
    }
</style>
<body>
    <div id="map" style="position: fixed; right: 0; left: 0; top: 0; bottom: 0;"></div>
    <div id="selectedLayer"></div>
    <div id="legend" style="position: absolute; bottom: 20px; right: 20px;">
        <div style="display: flex;">
            <!-- Legend content -->
        </div>
    </div>
    <!-- JS IMPORTS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="js/setup.js"></script>
    <script src="js/data.js"></script>
    <script>
        // Assuming data.js has properly initialized the `data` variable
        document.addEventListener('DOMContentLoaded', function () {
            function getContinent(data, CONTINENT) {
                var filteredData = {"type":"FeatureCollection","features":[]};
                for (var i = 0; i < data.features.length; i++) {
                    if (data.features[i].properties.CONTINENT === CONTINENT) {
                        filteredData.features.push(data.features[i]);
                    }
                }
                return filteredData;
            }

            var continents = {
                "Africa": getContinent(data, "Africa"),
                "Antarctica": getContinent(data, "Antarctica"),
                "Asia": getContinent(data, "Asia"),
                "North America": getContinent(data, "North America"),
                "South America": getContinent(data, "South America"),
                "Australia": getContinent(data, "Oceania"),
                "Europe": getContinent(data, "Europe")
            };

            function createPopupContent(feature) {
                // Popup content creation logic
                return "<div style='font-size:20px'>...</div>";
            }

            function onEachFeature(feature, layer) {
                layer.on({
                    mouseover: function(e) { /* logic */ },
                    mouseout: function(e) { /* logic */ },
                    click: function(e) { /* logic */ }
                });
                layer.bindPopup(createPopupContent(feature));
                layer.bindTooltip(feature.properties.countriesPracIR, {
                    permanent: true,
                    direction: "center",
                    className: "building-label",
                    opacity: 0.9,
                    backgroundColor: null,
                    textColor: "#000000"
                });
            }

            var layers = {};
            for (var continent in continents) {
                layers[continent] = L.geoJSON(continents[continent], {
                    onEachFeature: onEachFeature
                }).addTo(map);
            }

            L.control.layers(layers, {}, {collapsed:false}).addTo(map);
        });
    </script>
</body>
</html>
